package vulnerabilities.framework.securerandom;

import android.content.Context;
import android.util.Log;

import java.security.SecureRandom;

import vulnerabilities.VulnerabilityTest;

public class SecureRandomTest implements VulnerabilityTest{
    /*
    https://android.googlesource.com/platform/libcore/+/ab6d7714b47c04cc4bd812b32e6a6370181a06e4%5E%21/#F0

     */
    @Override
    public String getName() {
        return "SecureRandomTest";
    }

    @Override
    public boolean isVulnerable(Context context) throws Exception {
       long [] histogram = new long[256];

       for(int i = 0; i < histogram.length; i++){
           histogram[i] = 0;
       }

        byte[] buf = new byte[0x1000];
        for(int i = 0; i < 1000; i++) {
            SecureRandom sr = new SecureRandom();
            sr.nextBytes(buf);

            for(int j = 0; j < buf.length; j++)
                histogram[buf[j] & 0xFF]++;
        }

       for(int i = 0; i < histogram.length; i++)
           Log.d("Histogram", "i " + i + " : " + histogram[i]);

       return false;
    }
}
