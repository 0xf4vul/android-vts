package android.framework.util.jar;

import java.io.File;
import java.io.InputStream;
import java.security.cert.Certificate;
import java.util.Enumeration;
import java.util.zip.ZipFile;

public class JarFileHelper {
        public static Certificate[] getSignedJarCerts(String jarName, boolean chainCheck) throws Exception {
            File file = new File(jarName);
            Certificate[] foundCerts = null;

            JarFile jarFile = new JarFile(file, true, ZipFile.OPEN_READ, chainCheck);
            try {

                Enumeration<JarEntry> e = jarFile.entries();
                while (e.hasMoreElements()) {
                    JarEntry entry = e.nextElement();
                    InputStream is = jarFile.getInputStream(entry);
                    // Skip bytes because we have to read the entire file for it to read signatures.
                    is.skip(entry.getSize());
                    is.close();
                    Certificate[] certs = entry.getCertificates();
                    if (certs != null && certs.length > 0) {
                        foundCerts = certs;
                        break;
                    }
                }
            } finally {
                jarFile.close();
            }

            return foundCerts;
        }
}
